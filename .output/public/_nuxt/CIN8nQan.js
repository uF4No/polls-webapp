import S from"./DW787K8r.js";import{a2 as E,ah as D,r as C,ai as L,aj as R,ak as j,al as k,p as z,W as T,am as H,y as d,an as M,ao as $,a3 as F,l as I,ap as K,n as q,A as B,i as U,c as g,a as f,t as _,v as N,F as W,$ as Y,x as G,o as w,a0 as J,b as Q}from"./B6x4_DXj.js";import{u as X}from"./CX6VZ4dE.js";import"./DDHX_lXK.js";function Z(t){return Array.isArray(t)?t:[t]}const A=t=>t==="defer"||t===!1;function ee(...t){var i;const o=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(o);let[a,m,e={}]=t;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof m!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const s=E(),r=m,O=()=>D.value,v=()=>s.isHydrating?s.payload.data[a]:s.static.data[a];e.server=e.server??!0,e.default=e.default??O,e.getCachedData=e.getCachedData??v,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??D.deep,e.dedupe=e.dedupe??"cancel";const y=e.getCachedData(a,s),P=y!=null;if(!s._asyncData[a]||!e.immediate){(i=s.payload._errors)[a]??(i[a]=D.errorValue);const c=e.deep?C:L;s._asyncData[a]={data:c(P?y:e.default()),pending:C(!P),error:R(s.payload._errors,a),status:C("idle"),_default:e.default}}const n={...s._asyncData[a]};delete n._default,n.refresh=n.execute=(c={})=>{if(s._asyncDataPromises[a]){if(A(c.dedupe??e.dedupe))return s._asyncDataPromises[a];s._asyncDataPromises[a].cancelled=!0}if(c._initial||s.isHydrating&&c._initial!==!1){const u=c._initial?y:e.getCachedData(a,s);if(u!=null)return Promise.resolve(u)}n.pending.value=!0,n.status.value="pending";const p=new Promise((u,l)=>{try{u(r(s))}catch(V){l(V)}}).then(async u=>{if(p.cancelled)return s._asyncDataPromises[a];let l=u;e.transform&&(l=await e.transform(u)),e.pick&&(l=se(l,e.pick)),s.payload.data[a]=l,n.data.value=l,n.error.value=D.errorValue,n.status.value="success"}).catch(u=>{if(p.cancelled)return s._asyncDataPromises[a];n.error.value=H(u),n.data.value=d(e.default()),n.status.value="error"}).finally(()=>{p.cancelled||(n.pending.value=!1,delete s._asyncDataPromises[a])});return s._asyncDataPromises[a]=p,s._asyncDataPromises[a]},n.clear=()=>te(s,a);const h=()=>n.refresh({_initial:!0}),b=e.server!==!1&&s.payload.serverRendered;{const c=M();if(c&&!c._nuxtOnBeforeMountCbs){c._nuxtOnBeforeMountCbs=[];const l=c._nuxtOnBeforeMountCbs;j(()=>{l.forEach(V=>{V()}),l.splice(0,l.length)}),k(()=>l.splice(0,l.length))}b&&s.isHydrating&&(n.error.value||y!=null)?(n.pending.value=!1,n.status.value=n.error.value?"error":"success"):c&&(s.payload.serverRendered&&s.isHydrating||e.lazy)&&e.immediate?c._nuxtOnBeforeMountCbs.push(h):e.immediate&&h();const p=$();if(e.watch){const l=z(e.watch,()=>n.refresh());p&&T(l)}const u=s.hook("app:data:refresh",async l=>{(!l||l.includes(a))&&await n.refresh()});p&&T(u)}const x=Promise.resolve(s._asyncDataPromises[a]).then(()=>n);return Object.assign(x,n),x}async function ae(t){await new Promise(a=>F(a));const o=t?Z(t):void 0;await E().hooks.callHookParallel("app:data:refresh",o)}function te(t,o){o in t.payload.data&&(t.payload.data[o]=void 0),o in t.payload._errors&&(t.payload._errors[o]=D.errorValue),t._asyncData[o]&&(t._asyncData[o].data.value=void 0,t._asyncData[o].error.value=D.errorValue,t._asyncData[o].pending.value=!1,t._asyncData[o].status.value="idle"),o in t._asyncDataPromises&&(t._asyncDataPromises[o]&&(t._asyncDataPromises[o].cancelled=!0),t._asyncDataPromises[o]=void 0)}function se(t,o){const a={};for(const m of o)a[m]=t[m];return a}const oe={class:"max-w-2xl mx-auto space-y-8"},ne={key:0,class:"flex justify-center"},re={key:1,class:"bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 border border-gray-700/50"},le={class:"text-3xl font-bold text-gray-100"},ie={class:"mt-4 space-y-6"},ce={class:"text-sm text-gray-400 space-y-2"},de={class:"space-y-4"},ue={class:"flex-1 p-4 bg-gray-700/50 rounded-lg"},fe={class:"flex justify-between items-center"},pe={class:"mt-2 w-full bg-gray-700 rounded-full h-2.5"},ye=["onClick","disabled"],me={key:0,class:"text-red-400 text-sm"},_e={key:2,class:"text-center text-gray-400"},De=I({__name:"[id]",async setup(t){let o,a;const m=K(),{address:e}=q(),s=([o,a]=B(()=>X()),o=await o,a(),o),{data:r,pending:O}=([o,a]=B(async()=>ee(`poll-${m.params.id}`,async()=>{const i=await s.getPoll(BigInt(m.params.id));return{id:i[0],title:i[2],deadline:i[7],owner:i[1],optionOneVotes:i[5],optionTwoVotes:i[6],optionOne:i[3],optionTwo:i[4]}})),o=await o,a(),o),v=C(!1),y=C(""),P=async i=>{var c,p;if(r.value){v.value=!0,y.value="";try{if(console.log(r.value.owner.toLowerCase(),(c=e.value)==null?void 0:c.toLowerCase()),r.value.owner.toLowerCase()===((p=e.value)==null?void 0:p.toLowerCase())){y.value="You cannot vote on your own poll.";return}const u=await s.vote(r.value.id,i);if(console.log("Transaction receipt:",u),u.status==="success")await ae(`poll-${m.params.id}`);else throw new Error("Transaction failed")}catch(u){y.value="Failed to submit vote. Please try again.",console.error(u)}finally{v.value=!1}}},n=i=>new Date(Number(i)*1e3).toLocaleString(),h=i=>Date.now()<Number(i)*1e3,b=U(()=>r.value?r.value.optionOneVotes+r.value.optionTwoVotes:0n),x=i=>!r.value||b.value===0n?0:Number(i*100n/b.value);return(i,c)=>{const p=S;return w(),g("div",oe,[d(O)?(w(),g("div",ne,c[0]||(c[0]=[f("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"},null,-1)]))):d(r)?(w(),g("div",re,[f("h1",le,_(d(r).title),1),f("div",ie,[f("div",{class:N(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",h(d(r).deadline)?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"])},_(h(d(r).deadline)?"Active":"Ended"),3),f("div",ce,[f("p",null,"Created by: "+_(d(r).owner),1),f("p",null,"Ends: "+_(n(d(r).deadline)),1),f("p",null,"Total Votes: "+_(d(b).toString()),1)]),f("div",de,[(w(),g(W,null,Y([1,2],(u,l)=>f("div",{key:l,class:"flex gap-4 items-center"},[f("div",ue,[f("div",fe,[f("span",null,_(l===0?d(r).optionOne:d(r).optionTwo),1),f("span",null,_(x(l===0?d(r).optionOneVotes:d(r).optionTwoVotes))+"%",1)]),f("div",pe,[f("div",{class:"bg-primary-500 h-2.5 rounded-full transition-all",style:J({width:`${x(l===0?d(r).optionOneVotes:d(r).optionTwoVotes)}%`})},null,4)])]),f("button",{onClick:V=>P(u),disabled:!h(d(r).deadline)||d(v),class:"h-full aspect-square p-4 bg-gray-700/50 rounded-lg hover:bg-primary-500/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[Q(p,{name:"material-symbols:how-to-vote",class:N(["text-xl text-primary-500",{"animate-spin":d(v)}])},null,8,["class"])],8,ye)])),64))]),d(y)?(w(),g("p",me,_(d(y)),1)):G("",!0)])])):(w(),g("div",_e," Poll not found "))])}}});export{De as default};
